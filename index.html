<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>T√≥tem Pedido - Casino UCM</title>
<style>
  /* Reset b√°sico */
  * {
    box-sizing: border-box;
  }
  body {
    font-family: Arial, sans-serif;
    background: white;
    color: black;
    margin: 0; padding: 1rem;
    min-height: 100vh;
  position: relative;
  background-image: url("https://portal.ucm.cl//content/uploads/bfi_thumb/UCMITO-2-qcxsudcnucv3qaliz3bxgljj37fx4m6vm5cfhjldv4.jpg");
  background-repeat: no-repeat;
  background-size: cover;
  background-position: center;
  background-attachment: fixed;
  z-index: 0;
}

/* Capa para transparencia */
body::before {
  content: "";
  position: fixed;
  inset: 0;
  background: rgba(255, 255, 255, 0.5); /* 50% transparente */
  pointer-events: none;
  z-index: -1;
}

/* En m√≥vil, transparencia 100% */
@media (max-width: 700px) {
  body::before {
    background: rgba(255, 255, 255, 1);
  }
  body {
    background-attachment: scroll; /* para mejor rendimiento en m√≥vil */
  }
}

  h1, h2, h3 {
    color: #00a2e3;
  }
  button {
    cursor: pointer;
    border: none;
    border-radius: 5px;
    padding: 0.5rem 1rem;
    font-weight: 600;
    background-color: #00a2e3;
    color: white;
    transition: background-color 0.3s ease;
  }
  button:hover:not(:disabled) {
    background-color: #008fcc;
  }
  button:disabled {
    background-color: #a0cde9;
    cursor: not-allowed;
  }
  .container {
    max-width: 900px;
    margin: auto;
  }
  .grid-3 {
    display: grid;
    grid-template-columns: 2fr 1fr;
    gap: 1rem;
  }
  .category {
    margin-bottom: 1.5rem;
  }
  .category-header {
    display: flex;
    align-items: center;
    gap: 0.5rem;
    margin-bottom: 0.5rem;
    font-weight: bold;
    font-size: 1.1rem;
  }
  .items {
    display: grid;
    grid-template-columns: repeat(auto-fill,minmax(140px,1fr));
    gap: 0.75rem;
  }
  .card {
    border: 1px solid #ccc;
    border-radius: 8px;
    padding: 0.75rem;
    background: #f9f9f9;
    display: flex;
    flex-direction: column;
    justify-content: space-between;
  }
  .item-name {
    font-weight: 600;
  }
  .item-price {
    margin: 0.5rem 0;
    color: #555;
  }
  /* Carrito */
  .cart {
    background: #f0f8ff;
    border-radius: 8px;
    padding: 1rem;
    box-shadow: 0 0 8px #00a2e3aa;
  }
  .cart-empty {
    color: #888;
  }
  .cart-list {
    list-style: none;
    padding-left: 0;
    margin-bottom: 1rem;
  }
  .cart-list li {
    display: flex;
    justify-content: space-between;
    align-items: center;
    border-bottom: 1px solid #ccc;
    padding: 0.3rem 0;
  }
  .cart-list li span {
    flex: 1;
  }
  .cart-list li button {
    background-color: #e53935;
    margin-left: 0.5rem;
    padding: 0.25rem 0.5rem;
    font-weight: 700;
    font-size: 0.9rem;
  }
  .cart-list li button:hover:not(:disabled) {
    background-color: #b71c1c;
  }
  .cart-total {
    font-weight: 700;
    font-size: 1.2rem;
    display: flex;
    justify-content: space-between;
  }
  /* Modal */
  .modal-bg {
    position: fixed;
    inset: 0;
    background-color: #00000088;
    display: none;
    justify-content: center;
    align-items: center;
    z-index: 999;
  }
  .modal-bg.active {
    display: flex;
  }
  .modal {
    background: white;
    border-radius: 8px;
    width: 90%;
    max-width: 400px;
    padding: 1rem 1.5rem;
    box-shadow: 0 0 15px #00a2e3aa;
    text-align: center;
  }
  .modal h3 {
    margin-top: 0;
    margin-bottom: 1rem;
  }
  .modal button {
    margin: 0.3rem;
    width: 120px;
  }
  /* Loader */
  .loader {
    border: 5px solid #f3f3f3;
    border-top: 5px solid #00a2e3;
    border-radius: 50%;
    width: 50px;
    height: 50px;
    animation: spin 1.2s linear infinite;
    margin: 1rem auto;
  }
  @keyframes spin {
    0% { transform: rotate(0deg);}
    100% {transform: rotate(360deg);}
  }
  /* Boleta */
  .receipt {
    background: #eef9ff;
    border-radius: 8px;
    padding: 1rem;
    margin-top: 1rem;
    text-align: left;
    font-size: 0.9rem;
    color: #333;
  }
  .receipt p {
    margin: 0.2rem 0;
  }
  .receipt ul {
    list-style: none;
    padding-left: 0;
    margin: 0.5rem 0;
  }
  .receipt ul li {
    display: flex;
    justify-content: space-between;
    border-bottom: 1px dotted #ccc;
    padding: 0.25rem 0;
  }
  .receipt .total {
    font-weight: 700;
    margin-top: 0.5rem;
    display: flex;
    justify-content: space-between;
  }
  /* Iconos simples */
  .icon {
    width: 20px;
    height: 20px;
    fill: #00a2e3;
  }
  /* Responsive */
  @media(max-width: 700px){
    .grid-3 {
      grid-template-columns: 1fr;
    }
  }
</style>
</head>
<body>
  <div class="container">
    <h1>T√≥tem de Pedido - Casino UCM</h1>
    <div class="grid-3">
      <section>
        <h2>Men√∫</h2>
        <div id="menu-container"></div>
      </section>
      <aside>
        <h2>Tu Pedido</h2>
        <div class="cart" id="cart-container">
          <p class="cart-empty">No has agregado productos.</p>
          <!-- Aqu√≠ NO se pone el bot√≥n, porque se limpia container -->
        </div>
        <!-- Bot√≥n confirmar fuera del contenedor que se limpia -->
        <button id="btn-confirmar-pedido" style="margin-top:1rem; display:none;">Confirmar Pedido</button>
      </aside>
    </div>
  </div>

  <!-- Modal de selecci√≥n m√©todo pago -->
  <div id="modal-payment" class="modal-bg" role="dialog" aria-modal="true" aria-labelledby="modal-payment-title">
    <div class="modal">
      <h3 id="modal-payment-title">Selecciona el m√©todo de pago</h3>
      <button data-method="D√©bito">D√©bito</button>
      <button data-method="Cr√©dito">Cr√©dito</button>
      <button data-method="EdenRed">EdenRed</button>
      <br />
      <button id="modal-payment-cancel" style="margin-top:1rem; background:#ccc; color:#333;">Cancelar</button>
    </div>
  </div>

  <!-- Modal de proceso de pago -->
  <div id="modal-processing" class="modal-bg" role="alert" aria-live="assertive" aria-busy="true" aria-label="Procesando pago">
    <div class="modal">
      <h3>Procesando pago</h3>
      <div class="loader" aria-hidden="true"></div>
      <p id="processing-message"></p>
    </div>
  </div>

  <!-- Modal de pago exitoso -->
  <div id="modal-success" class="modal-bg" role="dialog" aria-modal="true" aria-labelledby="modal-success-title">
    <div class="modal">
      <h3 id="modal-success-title">Compra realizada</h3>
      <p>¬°Compra realizada con √©xito!</p>
      <div class="receipt" id="receipt-container"></div>
      <button id="success-close">Volver al inicio</button>
    </div>
  </div>

<script>
  const MAX_CANTIDAD = 10;

  // Datos men√∫
  const MENU = [
    { id: 1, nombre: "Empanada de Queso", precio: 1200, categoria: "Comestibles", icon: "üç¨" },
    { id: 2, nombre: "Completo Italiano", precio: 1800, categoria: "Comestibles", icon: "üå≠" },
    { id: 3, nombre: "Colaci√≥n Vegetariana", precio: 2500, categoria: "Almuerzo", icon: "ü•ó" },
    { id: 4, nombre: "Colaci√≥n Carne", precio: 2700, categoria: "Almuerzo", icon: "üçñ" },
    { id: 5, nombre: "Caf√©", precio: 800, categoria: "Bebidas", icon: "‚òï" },
    { id: 6, nombre: "Jugo Natural", precio: 1000, categoria: "Bebidas", icon: "üßÉ" },
    { id: 7, nombre: "Queque", precio: 900, categoria: "Postre", icon: "üç∞" },
    { id: 8, nombre: "Galletas", precio: 600, categoria: "Postre", icon: "üç™" },
  ];

  const CATEGORIAS = [
    { nombre: "Almuerzo", icon: "üçΩÔ∏è" },
    { nombre: "Bebidas", icon: "ü•§" },
    { nombre: "Comestibles", icon: "üç¨" },
    { nombre: "Postre", icon: "üç∞" },
  ];

  let carrito = [];

  // Formatear n√∫mero con puntos
  function formatNumber(num) {
    return num.toString().replace(/\B(?=(\d{3})+(?!\d))/g, ".");
  }

  // Render men√∫
  function renderMenu() {
    const container = document.getElementById("menu-container");
    container.innerHTML = "";
    CATEGORIAS.forEach(({ nombre, icon }) => {
      const catDiv = document.createElement("div");
      catDiv.className = "category";

      const header = document.createElement("div");
      header.className = "category-header";
      header.innerHTML = `<span class="icon">${icon}</span> <span>${nombre}</span>`;
      catDiv.appendChild(header);

      const itemsDiv = document.createElement("div");
      itemsDiv.className = "items";

      MENU.filter(i => i.categoria === nombre).forEach(item => {
        const card = document.createElement("div");
        card.className = "card";

        const name = document.createElement("p");
        name.className = "item-name";
        name.textContent = item.nombre;
        card.appendChild(name);

        const price = document.createElement("p");
        price.className = "item-price";
        price.textContent = `$${formatNumber(item.precio)}`;
        card.appendChild(price);

        const btn = document.createElement("button");
        btn.textContent = "Agregar";
        btn.style.marginTop = "auto";
        btn.onclick = () => agregar(item);
        card.appendChild(btn);

        itemsDiv.appendChild(card);
      });

      catDiv.appendChild(itemsDiv);
      container.appendChild(catDiv);
    });
  }

  // Agregar producto, con l√≠mite max 10 por producto
  function agregar(item) {
    const index = carrito.findIndex(p => p.id === item.id);
    if (index > -1) {
      if(carrito[index].cantidad < MAX_CANTIDAD){
        carrito[index].cantidad++;
      } else {
        alert(`No puedes agregar m√°s de ${MAX_CANTIDAD} unidades de este producto.`);
      }
    } else {
      carrito.push({ ...item, cantidad: 1 });
    }
    renderCarrito();
  }

  // Quitar producto
  function quitar(item) {
    const index = carrito.findIndex(p => p.id === item.id);
    if (index > -1) {
      if (carrito[index].cantidad > 1) {
        carrito[index].cantidad--;
      } else {
        carrito.splice(index, 1);
      }
    }
    renderCarrito();
  }

  // Render carrito
  function renderCarrito() {
    const container = document.getElementById("cart-container");
    container.innerHTML = "";

    if (carrito.length === 0) {
      const p = document.createElement("p");
      p.className = "cart-empty";
      p.textContent = "No has agregado productos.";
      container.appendChild(p);
      btnConfirm.style.display = "none";
      return;
    }

    const ul = document.createElement("ul");
    ul.className = "cart-list";

    carrito.forEach(item => {
      const li = document.createElement("li");

      const itemSpan = document.createElement("span");
      itemSpan.textContent = `${item.nombre} x${item.cantidad}`;
      li.appendChild(itemSpan);

      const priceSpan = document.createElement("span");
      priceSpan.textContent = `$${formatNumber(item.precio * item.cantidad)}`;
      priceSpan.style.minWidth = "70px";
      priceSpan.style.textAlign = "right";
      li.appendChild(priceSpan);

      const btnQuitar = document.createElement("button");
      btnQuitar.textContent = "‚àí";
      btnQuitar.title = "Quitar uno";
      btnQuitar.onclick = () => quitar(item);
      li.appendChild(btnQuitar);

      ul.appendChild(li);
    });

    container.appendChild(ul);

    const total = carrito.reduce((acc, i) => acc + i.precio * i.cantidad, 0);
    const divTotal = document.createElement("div");
    divTotal.className = "cart-total";
    divTotal.innerHTML = `<span>Total</span> <span>$${formatNumber(total)}</span>`;
    container.appendChild(divTotal);

    btnConfirm.style.display = "block";
  }

  // Modales
  const modalPago = document.getElementById("modal-payment");
  const modalProcesando = document.getElementById("modal-processing");
  const modalExito = document.getElementById("modal-success");
  const processingMsg = document.getElementById("processing-message");
  const receiptContainer = document.getElementById("receipt-container");

  // Bot√≥n confirmar fuera de carrito
  const btnConfirm = document.getElementById("btn-confirmar-pedido");
  btnConfirm.onclick = () => abrirModalPago();

  function abrirModalPago() {
    if (carrito.length === 0) return;
    modalPago.classList.add("active");
  }

  document.getElementById("modal-payment-cancel").onclick = () => {
    modalPago.classList.remove("active");
  };

  modalPago.querySelectorAll("button[data-method]").forEach(btn => {
    btn.onclick = () => {
      const metodo = btn.getAttribute("data-method");
      modalPago.classList.remove("active");
      iniciarProcesoPago(metodo);
    };
  });

  function iniciarProcesoPago(metodo) {
    let mensaje = "";
    if (metodo === "D√©bito" || metodo === "Cr√©dito") {
      mensaje = "Por favor, inserta tu tarjeta en el lector de pagos.";
    } else {
      mensaje = "Ingresa tu c√≥digo din√°mico de EdenRed desde la aplicaci√≥n m√≥vil.";
    }
    processingMsg.textContent = mensaje;

    modalProcesando.classList.add("active");

    setTimeout(() => {
      modalProcesando.classList.remove("active");
      mostrarExitoPago(metodo);
    }, 2500);
  }

  function mostrarExitoPago(metodo) {
    const fecha = new Date();
    const fechaStr = fecha.toLocaleString();
    const transId = Math.random().toString(36).substr(2, 10).toUpperCase();

    let htmlBoleta = `
      <p><strong>Fecha:</strong> ${fechaStr}</p>
      <p><strong>ID Transacci√≥n:</strong> ${transId}</p>
      <ul>
    `;
    let total = 0;
    carrito.forEach(item => {
      const itemTotal = item.precio * item.cantidad;
      total += itemTotal;
      htmlBoleta += `<li>${item.nombre} x${item.cantidad} <span style="float:right;">$${formatNumber(itemTotal)}</span></li>`;
    });
    htmlBoleta += `</ul>`;
    htmlBoleta += `<div class="total"><span>Total</span><span>$${formatNumber(total)}</span></div>`;

    receiptContainer.innerHTML = htmlBoleta;

    modalExito.classList.add("active");
    carrito = [];
    renderCarrito();
  }

  document.getElementById("success-close").onclick = () => {
    modalExito.classList.remove("active");
  };

  // Inicializar
  renderMenu();
  renderCarrito();
</script>
</body>
</html>
